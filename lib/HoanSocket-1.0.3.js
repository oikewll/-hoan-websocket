!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).HoanSocket=t()}(this,function(){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.connectURL=e||"",this.lastHealth=-1,this.heartbeatIdleTime=25e3,this.heartbeatInterval=1e4,this.heartbeatCMessage="~H#C~",this.heartbeatSMessage="~H#S~",this.timeoutObj=null,this.reconnectTime=2e3,this.reconnectObj=null,this.isDestroy=!1,this.isDebug=!1,this.init()}var e,n,o;return e=t,(n=[{key:"init",value:function(){this.webSocketObj=new WebSocket(this.connectURL),window.addEventListener("offline",function(e){console.log("offline")}),window.addEventListener("online",function(e){console.log("online")})}},{key:"onopen",value:function(e){this.isDebug&&console.log(e)}},{key:"onmessage",value:function(e){this.isDebug&&console.log(e)}},{key:"onerror",value:function(e){this.isDebug&&console.log(e)}},{key:"onclose",value:function(e){this.isDebug&&console.log(e)}},{key:"send",value:function(e){e="string"==typeof e?e:JSON.stringify(e);this.webSocketObj.send(e),this.isDebug&&console.warn("ws发送消息==>：".concat(e))}},{key:"create",value:function(e){var t=this;e&&Object.assign(this,e);e=this.webSocketObj;e.onopen=function(e){t.onopen(e),t.heartStart()},e.onmessage=function(e){t.lastHealth=Date.now(),t.heartReset(),e.data!=t.heartbeatSMessage&&t.onmessage(e)},e.onerror=function(e){t.onerror(e)},e.onclose=function(e){t.onclose(e),t.deteck()}}},{key:"deteck",value:function(){var e=this;this.isDestroy||(this.isDestroy=!0,this.webSocketObj.close(),this.reconnectObj=setTimeout(function(){e.reconnect()},this.reconnectTime))}},{key:"destroy",value:function(){clearTimeout(this.timeoutObj),clearTimeout(this.reconnectObj),this.isDestroy=!0,this.webSocketObj.close()}},{key:"heartStart",value:function(){var e=this;if(1!=this.webSocketObj.readyState)return!1;this.timeoutObj=setInterval(function(){return-1!==e.lastHealth&&Date.now()-e.lastHealth>e.heartbeatIdleTime?(e.isDebug&&console.log("服务器没有响应."),void e.webSocketObj.close()):void(1==e.webSocketObj.readyState?(0===e.webSocketObj.bufferedAmount?e.webSocketObj.send(e.heartbeatCMessage):console.log("数据未发送完毕! "+(new Date).toUTCString()),e.isDebug&&console.log("连接正常! "+(new Date).toUTCString())):e.isDebug&&console.log("连接断开! "+(new Date).toUTCString()))},this.heartbeatInterval)}},{key:"heartReset",value:function(){clearTimeout(this.timeoutObj),this.heartStart()}},{key:"reconnect",value:function(){this.isDebug&&console.log("断线重连中..."),this.timeoutObj&&clearTimeout(this.timeoutObj);var e=this.connectURL;this.webSocketObj=new WebSocket(e),this.isDestroy=!1,this.create()}}])&&i(e.prototype,n),o&&i(e,o),t}()});
//# sourceMappingURL=HoanSocket-1.0.3.js.map
